import{P as u}from"./vendor-net-CCZgVoDP.js";import{m as p,H as y}from"./vendor-ai-CNZffakN.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const d of s.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function a(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=a(o);fetch(o.href,s)}})();const v={SYSTEM_PASSWORD:"nexus"},n={user:{name:"Guest",avatar:"üë§"},room:"public",apiKeys:JSON.parse(localStorage.getItem("nexus_api_keys")||"{}"),currentProvider:localStorage.getItem("nexus_provider")||"groq",currentModel:localStorage.getItem("nexus_model")||"llama-3.3-70b-versatile",isUnlocked:!1,preloadedInvite:null};function x(){localStorage.setItem("nexus_api_keys",JSON.stringify(n.apiKeys)),localStorage.setItem("nexus_provider",n.currentProvider),localStorage.setItem("nexus_model",n.currentModel)}let l=null;const b=[{host:"broker.emqx.io",port:8084,ssl:!0},{host:"test.mosquitto.org",port:8080,ssl:!1}];function m(){if(l&&l.isConnected())return;const t=b[0],r="nexus_"+Math.random().toString(16).substr(2,8);l=new u.MQTT.Client(t.host,t.port,"/mqtt",r),l.onConnectionLost=()=>{e.apiStatus.className="w-2 h-2 rounded-full bg-red-500 animate-pulse",setTimeout(m,2e3)},l.onMessageArrived=a=>{const i=JSON.parse(a.payloadString);i.user!==n.user.name&&i.type==="chat"&&e.addMessage(i.text,!1,i.user,i.avatar)},l.connect({onSuccess:()=>{console.log("MQTT Connected"),e.apiStatus.className="w-2 h-2 rounded-full bg-cyan-400 shadow-[0_0_10px_#00e5ff]";const a=n.room==="public"?"termos/public":`termos/rooms/${n.room}`;l.subscribe(a)},useSSL:t.ssl})}function S(t){if(!l||!l.isConnected())return;const r=n.room==="public"?"termos/public":`termos/rooms/${n.room}`,a=new u.MQTT.Message(JSON.stringify({type:"chat",user:n.user.name,avatar:n.user.avatar,text:t}));a.destinationName=r,l.send(a)}p.setOptions({highlight:t=>y.highlightAuto(t).value});async function I(t){const r=n.apiKeys[n.currentProvider];if(!r)throw new Error("API Key Missing");const i=Object.values(CONFIG.PROVIDERS).find(d=>d.url.includes(n.currentProvider)).url,o=await fetch(i,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({model:n.currentModel,messages:[{role:"user",content:t}]})});if(!o.ok)throw new Error(`API Error ${o.status}`);const s=await o.json();return p.parse(s.choices[0].message.content)}const e={app:document.getElementById("app"),authOverlay:document.getElementById("auth-overlay"),authInput:document.getElementById("auth-pass-input"),authBtn:document.getElementById("auth-btn"),authMsg:document.getElementById("auth-msg"),apiStatus:null,chatContainer:null,inputField:null};e.authBtn.addEventListener("click",f);e.authInput.addEventListener("keydown",t=>{t.key==="Enter"&&f()});function f(){if(e.authInput.value===v.SYSTEM_PASSWORD){if(n.isUnlocked=!0,n.preloadedInvite&&n.preloadedInvite.k){const t=n.preloadedInvite.k;n.apiKeys[t.provider]=t.key,n.currentProvider=t.provider,n.currentModel=t.model,x(),console.log("Invite Keys Applied")}e.authOverlay.style.opacity="0",setTimeout(()=>{e.authOverlay.style.display="none",e.app.style.opacity="1",w()},500)}else e.authOverlay.classList.add("shake-anim"),e.authMsg.innerText="ACCESS DENIED",setTimeout(()=>{e.authOverlay.classList.remove("shake-anim"),e.authMsg.innerText=""},1e3)}function E(){e.app.innerHTML=`
        <div class="scanlines"></div>
        <header class="fixed top-0 w-full h-16 glass-panel flex items-center justify-between px-4 z-40">
            <div class="text-xl font-header font-bold text-white">NEXUS <span class="text-cyan-400">AI</span></div>
            <div class="flex items-center gap-2">
                <div id="api-status" class="w-2 h-2 rounded-full bg-red-500"></div>
                <span id="room-display" class="text-xs font-mono text-gray-400">OFFLINE</span>
            </div>
        </header>
        
        <main id="chat-box" class="h-full pt-20 pb-24 px-4 overflow-y-auto max-w-2xl mx-auto flex flex-col gap-3">
            <div class="text-center text-gray-500 text-xs font-mono mt-10">SECURE CHANNEL ESTABLISHED</div>
        </main>

        <div class="fixed bottom-0 w-full glass-panel p-4 z-40">
            <div class="max-w-2xl mx-auto flex gap-2">
                <input id="user-input" type="text" placeholder="Command: /ai ..." class="flex-1 bg-black/50 border border-cyan-500/30 rounded-lg p-3 text-white outline-none focus:border-cyan-400 font-mono">
                <button id="send-btn" class="bg-cyan-600 hover:bg-cyan-500 text-black font-bold px-6 rounded-lg font-header">SEND</button>
            </div>
        </div>
    `,e.apiStatus=document.getElementById("api-status"),e.chatContainer=document.getElementById("chat-box"),e.inputField=document.getElementById("user-input"),document.getElementById("send-btn").addEventListener("click",c),e.inputField.addEventListener("keydown",t=>{t.key==="Enter"&&c()})}function w(){E(),m();const t=new URLSearchParams(window.location.search);if(t.get("s"))try{n.preloadedInvite=JSON.parse(atob(t.get("s"))),n.preloadedInvite.r&&(n.room=n.preloadedInvite.r),window.history.replaceState({},document.title,window.location.pathname)}catch{}}function c(){if(!n.isUnlocked)return;const t=e.inputField.value.trim();if(t)if(e.inputField.value="",t.startsWith("/ai")){const r=t.replace("/ai ","");e.addMessage(r,!0,"USER"),e.addMessage("Thinking...",!0,"AI",!0),I(r).then(a=>{e.chatContainer.lastChild.remove(),e.addMessage(a,!1,"AI","ü§ñ",!0)}).catch(a=>{e.chatContainer.lastChild.remove(),e.addMessage(`Error: ${a.message}`,!1,"SYS","‚ö†Ô∏è")})}else e.addMessage(t,!0,"USER"),S(t)}e.addMessage=function(t,r,a,i,o=!1){const s=document.createElement("div");s.className=`flex gap-3 ${r?"flex-row-reverse":""} animate-[slideUp_0.3s_ease-out]`;const d=`<div class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center text-xs shrink-0">${i||"üë§"}</div>`,h=r?"bg-gradient-to-r from-cyan-600 to-blue-600 text-black rounded-tr-none":"bg-white/10 text-white border border-white/10 rounded-tl-none",g=o?t:t.replace(/</g,"&lt;").replace(/>/g,"&gt;");s.innerHTML=`
        ${d}
        <div class="${h} p-3 rounded-2xl max-w-[80%] text-sm ${o?"markdown-body":"font-mono"}">
            ${g}
        </div>
    `,e.chatContainer.appendChild(s),e.chatContainer.scrollTop=e.chatContainer.scrollHeight};e.authOverlay.classList.remove("hidden");
